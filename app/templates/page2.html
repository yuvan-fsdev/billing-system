<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Invoice {{ invoice.purchase_id }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; color: #222; }
        h1, h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
        th { background-color: #f5f5f5; }
        .totals { margin-top: 1.5rem; }
        .totals div { margin-bottom: 0.3rem; }
        .denoms { margin-top: 1rem; }
        .denoms ul { list-style: none; padding: 0; }
        .denoms li { margin-bottom: 0.2rem; }
    </style>
</head>
<body>
<h1>Invoice #{{ invoice.purchase_id }}</h1>
<p><strong>Email:</strong> {{ invoice.customer_email }}</p>
<p><strong>Date:</strong> {{ invoice.created_at }}</p>

<h2>Line Items</h2>
<table>
    <thead>
    <tr>
        <th>Product Code</th>
        <th>Name</th>
        <th>Unit Price</th>
        <th>Quantity</th>
        <th>Tax %</th>
        <th>Purchase Price</th>
        <th>Tax Payable</th>
        <th>Total</th>
    </tr>
    </thead>
    <tbody>
    {% for line in invoice.lines %}
        <tr>
            <td>{{ line.product_code }}</td>
            <td>{{ line.product_name }}</td>
            <td>{{ line.unit_price }}</td>
            <td>{{ line.quantity }}</td>
            <td>{{ line.tax_percentage }}</td>
            <td>{{ line.purchase_price }}</td>
            <td>{{ line.tax_payable_for_item }}</td>
            <td>{{ line.total_price_of_item }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<div class="totals">
    <div><strong>Subtotal:</strong> {{ invoice.total_price_without_tax }}</div>
    <div><strong>Total Tax:</strong> {{ invoice.total_tax_payable }}</div>
    <div><strong>Net Price:</strong> {{ invoice.net_price }}</div>
    <div><strong>Rounded Total:</strong> {{ invoice.rounded_down_net_price }}</div>
    <div><strong>Paid Amount:</strong> {{ invoice.paid_amount }}</div>
    <div><strong>Balance to Customer:</strong> {{ invoice.balance_payable_to_customer }}</div>
    <div><strong>Change Remainder:</strong> {{ invoice.change_remainder }}</div>
</div>

<div class="denoms">
    <h2>Denomination Breakdown</h2>
    <h3>Paid</h3>
    <ul>
        {% for value, count in invoice.payment_denomination.items() %}
            <li>₹{{ value }} × {{ count }}</li>
        {% endfor %}
    </ul>
    <h3>Returned</h3>
    <ul>
        {% for value, count in invoice.balance_denomination.items() %}
            <li>₹{{ value }} × {{ count }}</li>
        {% endfor %}
    </ul>
</div>
</body>
</html>
